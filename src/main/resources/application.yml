nextflow:
  k8s:
    runAsUser: 9999
    namespace: "default" # Namespace where app will be running
    runNamespace: "default" # Namespace where wes and nf pods will live
    serviceAccount: "default"
    volMounts:
      - "task-pv-claim:/mnt/data"
    masterUrl: "https://192.168.99.100:8443"
    trustCertificate: false
  weblogUrl: "http://localhost:8083"
  monitor:
    sleepInterval: 1000 # milliseconds
    maxErrorLogLines: 50 # we put the last ${maxErrorLogLines} into the error message if a Pod fails

logging.level:
  com.pivotal: debug
#  org.springframework: debug
  org.icgc.argo: debug

secret:
  enabled: false

---
spring.profiles: secure
auth:
  jwtPublicKeyUrl: ""
  jwtPublicKeyStr: "-----BEGIN PUBLIC KEY-----\nSET ME IF YOU DONT HAVE A URL, BUT URL TAKES PRIORITY\n-----END PUBLIC KEY-----"
  graphqlScopes:
    queryOnly:
      - RDPC-CA.READ
    queryAndMutation:
      - RDPC-CA.WRITE

---
spring.profiles: apiKey

secret:
  enabled: true
  apiKey: testapikeytotallylegit

---
spring.profiles: oauth2Token

secret:
  enabled: true
  clientId: testId
  clientSecret: testSecret
  tokenUri: http://localhost:8080/oauth/token

---
spring.profiles: api,execute,gatekeeper

rabbit:
  default-endpoint-name: standalone
  endpoints:
    standalone:
      host: localhost
      port: 5672
      username: user
      password: pass

---
spring.profiles: api

api.producer.topology:
  queueName: "gatekeeper-in-queue"
  topicExchangeName: "gatekeeper-in"
  topicRoutingKeys:  "#" # comma separated Array of keys

---
spring.profiles: execute

execute.consumer.topology:
  queueName: "execute-queue"
  topicExchangeName: "gatekeeper-out"
  topicRoutingKeys: "INITIALIZING, CANCELING" # comma separated Array of keys

---
spring.profiles: gatekeeper

gatekeeper.consumer.topology:
  queueName: "gatekeeper-in-queue"
  topicExchangeName: "gatekeeper-in"

gatekeeper.producer.topology:
  queueName: "gatekeeper-out-default-queue"
  topicExchangeName: "gatekeeper-out"

spring.cloud.stream:
  function.definition: weblogConsumer
  bindings:
    weblogConsumer-in-0:
      group: mgmt-weblogConsumer
      destination: weblog # kafka topic to listen to
      binder: kafka
  kafka:
    binder.brokers: localhost:9092
    bindings:
      weblogConsumer-in-0:
        consumer:
          enableDlq: true
          dlqName: weblog-in-0_dlq
          autoCommitOnError: true
          autoCommitOffset: true

spring.datasource:
  url: jdbc:postgresql://localhost:5432/gatekeeperdb
  username: postgres
  password: mysecretpassword
spring.jpa:
  hibernate:
    ddl-auto: update
